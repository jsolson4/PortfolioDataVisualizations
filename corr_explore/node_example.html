
<meta charset="utf-8">

<!-- Class style sheet in linked in .css -->
<link rel = "stylesheet" href = "ticker_styles.css">

<!-- Load d3.js-->
<svg width = "960" height = "600"></svg>

<script src="https://unpkg.com/d3-force-boundary@0.0.1/dist/d3-force-boundary.min.js"></script>
<script type="text/javascript" src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://unpkg.com/d3-force-boundary@0.0.1/dist/d3-force-boundary.min.js"></script>
<!-- // Tutorial Link: https://www.youtube.com/watch?v=y2-sgZh49dQ -->

<!-- Set title (correct placement?)-->
<title>Corr Explore</title>

<!-- Create a div where the graph will take place -->
<div id = "bubble_container"></div>
<script>

var svg = d3.select("svg");
var width = svg.attr("width");
var height = svg.attr("height");

var graphData = {
    nodes: [{name: "A", radius:30}, {name: "B",radius:20}, {name: "C",radius:50}, {name: "D",radius:10},
            {name: "AA", radius:15}, {name: "BB",radius:10}, {name: "CC",radius:25}, {name: "DD",radius:5}],
    links:[
        {source:"A", target:"B", corr:0.5},
        {source:"A", target:"C", corr:0.3},
        {source:"A", target:"D", corr:0.2},
        {source:"B", target:"A", corr:0.9},
        {source:"B", target:"C", corr:0.8},
        {source:"B", target:"D", corr:0.7},
        {source:"D", target:"C", corr:0.1},
        {source:"A", target:"BB", corr:0.1},
        {source:"B", target:"CC", corr:0.1},
        {source:"D", target:"CC", corr:0.1},
    ]
};

// Notes
// fix drag functionality
// add/test charge strength where nodes are specifically attracted to one another... may have to be invisible links?

var simulation = d3
        .forceSimulation(graphData.nodes)
        .force("charge", d3.forceManyBody().strength(100))
        .force("center", d3.forceCenter(width / 2, height  / 2))
        .force("collide", 
            d3.forceCollide(function(d){
                return d.radius
            })
            .strength(0.7))
        .on("tick", ticked);

var links = svg
        .append("g")
        .selectAll("line")
        .data(graphData.links)
        .enter()
        .append("line")
        .attr("stroke-width", 3)
        .style("stroke", "orange");

var drag = d3
    .drag()
    .on("start", dragStart)
    .on("drag", dragged)
    .on("end", dragEnded);

var textsAndNodes = svg
    .append("g")
    .selectAll("g")
    .data(graphData.nodes)
    .enter()
    .append("g")
    .call(drag);
    

var circles = textsAndNodes
    .append("circle")
    .attr("r", function(d){
        return d.radius;
    })
    .attr("fill", "red");

var texts = textsAndNodes.append("text").text(
    function(d){
        return d.name;
    })
    ;


function ticked() {
    //translate(x,y)
    textsAndNodes.attr("transform", function(d){
        return "translate(" + d.x + ", " + d.y + ")";
    });

    links
    .attr("x1", function(d){
        return d.source.x;
    })
    .attr("y1", function(d){
        return d.source.y;
    })
    .attr("x2", function(d){
        return d.target.x;
    })
    .attr("x1", function(d){
        return d.target.y;
    });

    console.log(simulation.alpha());
}


    function dragStart(d, event) {
      {
        if (!event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
        }
    };


    function dragged(d, event) {
      d.fx = event.x;
      d.fy = event.y;
    };

    function dragEnded(event, d) {
        // if node has been dragged, activate pin response
        if (event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;

        // if d is selected, change color. 
        if (d.fixed == true) {
            d3.select(this)
            .select("circle")
            .style("fill", "#D72862")
        }

    };

</script>